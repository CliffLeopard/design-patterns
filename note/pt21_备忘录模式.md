## 备忘录模式

### 定义
备忘录模式是一种行为设计模式， 允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。

### 介绍
![备忘录类图](../pics/备忘录.png)
* 原发器 （Originator） 类可以生成自身状态的快照， 也可以在需要时通过快照恢复自身状态。
* 备忘录 （Memento） 是原发器状态快照的值对象 （value object）。 通常做法是将备忘录设为不可变的， 并通过构造函数一次性传递数据。
* 负责人 （Caretaker） 仅知道 “何时” 和 “为何” 捕捉原发器的状态， 以及何时恢复状态。 负责人通过保存备忘录栈来记录原发器的历史状态。 当原发器需要回溯历史状态时， 负责人将从栈中获取最顶部的备忘录， 并将其传递给原发器的恢复 （restoration） 方法。
* 在该实现方法中， 备忘录类将被嵌套在原发器中。 这样原发器就可访问备忘录的成员变量和方法， 即使这些方法被声明为私有。 另一方面， 负责人对于备忘录的成员变量和方法的访问权限非常有限： 它们只能在栈中保存备忘录， 而不能修改其状态。

### 优点
* 可以在不破坏对象封装情况的前提下创建对象状态快照。
* 可以通过让负责人维护原发器状态历史记录来简化原发器代码。

### 缺点
* 如果客户端过于频繁地创建备忘录， 程序将消耗大量内存。
* 负责人必须完整跟踪原发器的生命周期， 这样才能销毁弃用的备忘录。
* 绝大部分动态编程语言 （例如 PHP、 Python 和 JavaScript） 不能确保备忘录中的状态不被修改。


### 场景
* 当你需要创建对象状态快照来恢复其之前的状态时， 可以使用备忘录模式。
* 当直接访问对象的成员变量、 获取器或设置器将导致封装被突破时， 可以使用该模式。

### 与其他模式的关系
* 你可以同时使用`命令模式`和`备忘录模式`来实现 “撤销”。 在这种情况下， 命令用于对目标对象执行各种不同的操作， 备忘录用来保存一条命令执行前该对象的状态。
* 你可以同时使用`备忘录`和`迭代器模式`来获取当前迭代器的状态， 并且在需要的时候进行回滚。
* 有时候`原型模式`可以作为备忘录的一个简化版本， 其条件是你需要在历史记录中存储的对象的状态比较简单， 不需要链接其他外部资源， 或者链接可以方便地重建。